# 需求层次

在项目根目录下创建 `models`文件目录，新建 `db.js`

```text
//根目录 project
.
├── models/
│   └── db.js
├── index.js
├── package-lock.json
└── package.json
```



`db.js`该文件主要负责创建连接（池），将创建的连接实例导出共其他模块使用。

示例代码：

```js
const { Sequelize } = require("sequelize");

const sequelize = new Sequelize({
  dialect: "mysql",
  database: "test",
  username: "root",
  password: "mlbzdx",
  host: "localhost",
  define: {
    freezeTableName: true, // 全局配置禁止表名复数化
  },
});
(async () => {
  try {
    await sequelize.authenticate();
    console.log("Connection has been established successfully.");
  } catch (error) {
    console.error("Unable to connect to the database:", error);
  }
})();
module.exports = sequelize;

```

在Sequelize中，`new Sequelize()`构造函数用于创建数据库连接实例，其参数构成灵活多样，主要分为三种形式：**连接URI字符串**、**独立参数传递**和**配置对象形式**。以下是详细的参数构成说明，结合官方文档和最佳实践整理而成：

---

# 知识层面

- 学习并使用创建连接池的Sequelize构造函数，认识该函数的作用，传入的参数，返回的结果
- 学习通过 `authenticate()`方法来测试连接是否创立成功

## 一、配置对象传参（推荐）

完整的配置对象包含以下核心模块：

#### 1. **数据库连接配置**
| 参数       | 类型   | 必填       | 说明                                              |
| ---------- | ------ | ---------- | ------------------------------------------------- |
| `dialect`  | string | 是         | 指定数据库类型（如`mysql`, `postgres`, `sqlite`） |
| `host`     | string | 否         | 数据库服务器地址，默认`localhost`                 |
| `port`     | number | 否         | 数据库端口（如MySQL默认3306）                     |
| `username` | string | 否         | 认证用户名                                        |
| `password` | string | 否         | 认证密码                                          |
| `database` | string | 否         | 目标数据库名                                      |
| `storage`  | string | SQLite专用 | 文件路径（如`path/to/database.sqlite`）           |

#### 2. **连接池配置（`pool`）**
控制连接池行为，优化高并发场景：
```javascript
pool: {
  max: 5,      // 最大连接数（默认5）
  min: 0,      // 最小连接数（默认0）
  idle: 10000, // 连接空闲超时时间（ms，默认10000）
  acquire: 30000 // 获取连接的超时时间（ms，默认30000）
}
```
- **多进程建议**：若有3个进程且总连接数需≤90，则每个进程设置`max:30`

#### 3. **模型与表名配置（`define`）**
全局定义模型默认行为：
```javascript
define: {
  freezeTableName: true, // 禁用自动复数化表名（默认false）
  timestamps: true,     // 自动添加createdAt/updatedAt字段（默认true）
  underscored: true     // 字段名使用下划线命名（如created_at）
}
```

#### 4. **日志与调试（`logging`）**
控制查询日志输出：
```javascript
logging: console.log, // 默认输出SQL到控制台
// 可选值：
// - false：禁用日志
// - (msg) => logger.debug(msg)：自定义日志器
```

#### 5. **其他重要参数**
| 参数               | 说明                                                         |
| ------------------ | ------------------------------------------------------------ |
| `dialectOptions`   | 数据库驱动特定配置（如SSL证书）                              |
| `operatorsAliases` | 运算符别名（已弃用，建议避免使用）                           |
| `sync`             | 模型同步时的安全限制（如`match: /_test$/`仅匹配_test结尾的数据库） |

## 二、测试连接

如需测试连接，可使用`.authenticate()`方法验证配置是否正确。

```js
(async () => {
  try {
    await sequelize.authenticate();
    console.log("Connection has been established successfully.");
  } catch (error) {
    console.error("Unable to connect to the database:", error);
  }
})();
```

## 三、完整配置示例

```js
const sequelize = new Sequelize({
  // 基础连接
  dialect: 'postgres',
  host: 'db.server.com',
  port: 5432,
  username: 'admin',
  password: 'securePassword',
  database: 'app_db',

  // 连接池
  pool: {
    max: 10,
    min: 2,
    idle: 30000
  },

  // 模型默认配置
  define: {
    freezeTableName: true,
    timestamps: false
  },

  // 日志与调试
  logging: false,
  benchmark: true // 记录查询执行时间
});
  //测试连接
(async () => {
  try {
    await sequelize.authenticate();
    console.log("Connection has been established successfully.");
  } catch (error) {
    console.error("Unable to connect to the database:", error);
  }
})();
module.exports = sequelize;
```

