## 根据主键查找实例

`findByPk()` 是 `Sequelize` 中用于根据主键查找单个模型实例的方法。`Pk` 是 "Primary Key" 的缩写，表示主键。

使用 `findByPk()` 方法可以根据指定的主键值查找数据库中对应的模型实例。它接受一个参数，即要查找的主键值，并返回一个 Promise 对象。如果找到匹配的记录，则 Promise 对象会被解析为对应的模型实例；如果未找到匹配的记录，则 Promise 对象会被解析为 `null`。

以下是一个示例代码，演示了如何使用 `findByPk()` 方法查找一个名为 `User` 的模型实例：

```javascript
User.findByPk(1)
  .then((user) => {
    if (user) {
      console.log('User found:', user);
    } else {
      console.log('User not found');
    }
  })
  .catch((error) => {
    console.error('Error finding user:', error);
  });
```

在上述示例中，`User.findByPk(1)` 将根据主键值为 1 查找数据库中的 `User` 记录。如果找到了对应的记录，将在 `then()` 方法中获取到该模型实例，并进行相应的处理。如果未找到匹配的记录，则会在 `then()` 方法中得到 `null` 值。

## 查找单个实例

`findOne()` 方法是 `Sequelize` 中用于查找符合特定条件的单个模型实例的方法。它返回一个 Promise，解析为查询结果的单个实例对象。以下是关于 `findOne()` 方法的一些重要信息：

语法：

```javascript
Model.findOne(options)
```

参数：

- `options`（可选）：一个包含可选配置选项的对象。

返回值：

- 返回一个 Promise，解析为查询结果的单个实例对象。

使用示例：

```javascript
const { User } = require("./models");

// 根据条件查找单个用户实例
User.findOne({
  where: {
    email: "example@example.com",
  },
})
  .then((user) => {
    console.log("User found:", user);
  })
  .catch((error) => {
    console.error("Error fetching user:", error);
  });
```

在上述示例中，我们导入了 `User` 模型类，并使用 `findOne()` 方法来查找满足条件的单个用户实例。我们传递了一个包含条件的对象 `{ where: { email: "example@example.com" } }`，指定了要查找的用户的电子邮件地址为 "example@example.com"。这样，将返回符合条件的单个用户实例。

你还可以使用其他选项来进一步定制查询，例如使用 `attributes` 选项选择要返回的属性，使用 `include` 选项关联其他模型，使用 `order` 选项对结果进行排序等。

需要注意的是，如果没有找到符合条件的实例，`findOne()` 方法将返回 `null`。因此，在使用返回值之前，请确保进行有效性检查。

总结：`findOne()` 方法用于查找符合特定条件的单个模型实例，并返回一个 Promise，解析为查询结果的单个实例对象。可以使用选项来进一步定制查询。

## 查找所有实例

在 `Sequelize` 中，你可以使用 `findAll()` 方法来查找符合特定条件的模型实例。`findAll()` 方法返回一个 Promise，解析为包含查询结果的数组。以下是使用 `findAll()` 方法进行模型实例查找的示例代码：

```javascript
const { Class } = require("./models");

// 查找所有班级实例
Class.findAll()
  .then((classes) => {
    console.log("All classes:", classes);
  })
  .catch((error) => {
    console.error("Error fetching classes:", error);
  });

// 根据条件查找班级实例
Class.findAll({
  where: {
    className: "Math",
  },
})
  .then((classes) => {
    console.log("Math classes:", classes);
  })
  .catch((error) => {
    console.error("Error fetching Math classes:", error);
  });
```

在上述示例中，我们导入了 `Class` 模型类，并使用 `findAll()` 方法来查找班级实例。第一个示例中，我们没有传递任何条件，因此将返回所有班级实例。

第二个示例中，我们传递了一个包含条件的对象 `{ where: { className: "Math" } }`，指定了要查找的班级名称为 "Math"。这样，将返回符合条件的班级实例。

你还可以使用其他选项来进一步定制查询，例如使用 `attributes` 选项选择要返回的属性，使用 `include` 选项关联其他模型，使用 `order` 选项对结果进行排序等。

需要注意的是，`findAll()` 方法返回的结果是一个数组，即使只有一个匹配的实例也是如此。如果你只需要返回单个实例，可以使用 `findOne()` 方法。

总结：你可以使用 `findAll()` 方法来查找符合特定条件的模型实例，并通过 Promise 解析返回查询结果的数组。可以使用选项来进一步定制查询。

## 查询所有实例以及实例总数

`findAndCountAll()` 方法是 `Sequelize` 中用于查找符合特定条件的模型实例的数量和实例列表的方法。它返回一个 Promise，解析为一个包含 `count` 和 `rows` 属性的对象，其中 `count` 表示符合条件的实例数量，`rows` 是一个包含实例列表的数组。以下是关于 `findAndCountAll()` 方法的一些重要信息：

语法：
```javascript
Model.findAndCountAll(options)
```

参数：
- `options`（可选）：一个包含可选配置选项的对象。

返回值：
- 返回一个 Promise，解析为一个包含 `count` 和 `rows` 属性的对象。

使用示例：
```javascript
const { User } = require("./models");

// 查找所有用户实例的数量和列表
User.findAndCountAll()
  .then(({ count, rows }) => {
    console.log("Total users:", count);
    console.log("User list:", rows);
  })
  .catch((error) => {
    console.error("Error fetching users:", error);
  });

// 根据条件查找用户实例的数量和列表
User.findAndCountAll({
  where: {
    age: {
      [Op.gt]: 18,
    },
  },
})
  .then(({ count, rows }) => {
    console.log("Adult users:", count);
    console.log("Adult user list:", rows);
  })
  .catch((error) => {
    console.error("Error fetching adult users:", error);
  });
```

在上述示例中，我们导入了 `User` 模型类，并使用 `findAndCountAll()` 方法来查找符合条件的用户实例的数量和列表。第一个示例中，我们没有传递任何条件，因此将返回所有用户实例的数量和列表。

第二个示例中，我们传递了一个包含条件的对象 `{ where: { age: { [Op.gt]: 18 } } }`，指定了要查找年龄大于 18 岁的用户实例。这样，将返回符合条件的用户实例的数量和列表。

你还可以使用其他选项来进一步定制查询，例如使用 `attributes` 选项选择要返回的属性，使用 `include` 选项关联其他模型，使用 `order` 选项对结果进行排序等。

需要注意的是，`findAndCountAll()` 方法返回的结果是一个对象，其中 `count` 表示符合条件的实例数量，`rows` 表示实例列表的数组。

总结：`findAndCountAll()` 方法用于查找符合特定条件的模型实例的数量和实例列表，并返回一个 Promise，解析为一个包含 `count` 和 `rows` 属性的对象。可以使用选项来进一步定制查询。

## 查询中的可选参数

在 `Sequelize` 的查询方法中，你可以使用以下可选参数来进一步定制查询：

- `where`：一个包含查询条件的对象，用于筛选符合条件的实例。例如：`{ where: { name: 'John' } }`。
- `attributes`：一个数组或对象，用于指定要返回的属性。如果是数组，表示只返回指定的属性；如果是对象，可以指定要返回的属性和排除的属性。例如：`{ attributes: ['id', 'name'] }` 或 `{ attributes: { exclude: ['createdAt', 'updatedAt'] } }`。
- `include`：一个数组或对象，用于关联其他模型。可以指定要关联的模型以及关联的类型（`hasOne`、`hasMany`、`belongsTo` 等）。例如：`{ include: [{ model: Task, as: 'tasks' }] }`。
- `order`：一个数组或字符串，用于指定结果的排序方式。如果是字符串，表示按照指定的属性进行升序排序；如果是数组，可以指定多个排序条件。例如：`{ order: 'createdAt DESC' }` 或 `{ order: [['createdAt', 'DESC'], ['name', 'ASC']] }`。
- `limit`：一个整数，用于限制返回的结果数量。
- `offset`：一个整数，用于指定结果的偏移量，用于分页查询。
- `group`：一个字符串，用于按照指定的属性进行分组。
- `having`：一个字符串，用于指定分组的筛选条件。

这些可选参数可以根据你的需求进行组合和定制，以获取符合特定条件的模型实例。你可以根据需要选择使用其中的一个或多个参数。

总结：`findAll()` 方法的可选参数包括 `where`、`attributes`、`include`、`order`、`limit`、`offset`、`group` 和 `having`。这些参数可以用于定制查询，以获取符合特定条件的模型实例。

## 限定查询条件

在 `Sequelize` 的查询中，`where` 对象可以包含以下键来定义查询条件：

- 比较运算符：可以使用比较运算符（`Op`）来进行条件比较。常见的比较运算符包括：
  - `$eq`：等于
  - `$ne`：不等于
  - `$gt`：大于
  - `$gte`：大于等于
  - `$lt`：小于
  - `$lte`：小于等于
  - `$in`：在给定数组中
  - `$notIn`：不在给定数组中
  - `$like`：包含指定模式的字符串
  - `$notLike`：不包含指定模式的字符串
  - `$iLike`：不区分大小写地包含指定模式的字符串
  - `$notILike`：不区分大小写地不包含指定模式的字符串
  - `$between`：在给定范围内
  - `$notBetween`：不在给定范围内
  - `$isNull`：为 null
  - `$isNotNull`：不为 null

- 逻辑运算符：可以使用逻辑运算符（`Op`）来组合多个条件。常见的逻辑运算符包括：
  - `$and`：与关系
  - `$or`：或关系
  - `$not`：非关系

- 字段名：可以直接使用字段名作为键，表示对该字段进行条件筛选。例如：`{ name: 'John' }`。

- 嵌套条件：可以使用嵌套对象来表示复杂的条件筛选。例如：`{ age: { $gt: 18 } }`。

下面是一个示例，展示了如何使用 `where` 对象来定义查询条件：

```javascript
const { Op } = require('sequelize');

const users = await User.findAll({
  where: {
    age: {
      [Op.gt]: 18,
    },
    [Op.or]: [
      { name: 'John' },
      { name: 'Jane' },
    ],
  },
});
```

在上述示例中，我们使用了 `$gt` 运算符来指定年龄大于 18 的条件，使用 `$or` 运算符来指定名字为 "John" 或 "Jane" 的条件。

需要注意的是，`Op` 是 `Sequelize` 提供的运算符对象，需要通过解构赋值的方式导入。你可以根据具体的需求选择合适的运算符和键来定义查询条件。

总结：`where` 对象可以包含比较运算符、逻辑运算符、字段名和嵌套条件来定义查询条件。常见的比较运算符和逻辑运算符可以通过 `Op` 对象来访问。你可以根据具体的需求和运算符选择合适的键来定义查询条件。

## 查询练习：

* `admin` 登录/根据主键查询/得到所有管理员
* `student` 得到单个学生/分页得到学生
* `class` 得到所有班级/根据id查询班级
* `book` 根据书名来进行查询/根据作者来进行查询/